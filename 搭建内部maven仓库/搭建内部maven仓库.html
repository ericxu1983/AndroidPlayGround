<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.0.6 (451290)"/><meta name="author" content="tshirtmanid@163.com"/><meta name="created" content="2015-04-02 11:11:32 +0000"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2015-04-02 11:57:03 +0000"/><title>搭建内部maven仓库</title></head><body>
<div><span style="color: rgb(255, 38, 0);">需求：</span></div>
<div>1. 将一些公共基础库（例如日志，UI控件等）封装成library的方式，提供给有赞内部其他Android项目使用</div>
<div>2. 将一些业务封装成SDK的形式（也是library的形式), 提供给有赞内部其他Android项目使用</div>
<div><br/></div>
<div><span style="color: rgb(255, 38, 0);">分析：</span></div>
<div>1. 将库打包</div>
<div>2. 将包上传到内部maven服务器</div>
<div>3. 使用方在build.gradle里配置内部服务器的maven仓库地址, 制定依赖的库，便可方便使用</div>
<div><br/></div>
<div><span style="color: rgb(255, 38, 0);">分解：</span></div>
<div><span style="color: rgb(255, 38, 0);">将项目打包成库：</span></div>
<div><span style="color: rgb(255, 64, 255);">方式1：在Android Studio里，File-&gt;New Module-&gt;Android Library</span></div>
<div><img src="%E6%90%AD%E5%BB%BA%E5%86%85%E9%83%A8maven%E4%BB%93%E5%BA%93.resources/9C95A94A-77E2-4589-96CD-00F75F3FDF09.png" height="650" width="1080"/></div>
<div><br/></div>
<div><span style="color: rgb(255, 64, 255);">方式2：将已有非Library的工程转换成库工程</span></div>
<div>修改工程的build.gradle, 将apply plugin: ‘com.android.application’ 修改成：</div>
<div>apply plugin: 'com.android.library'</div>
<div><br/></div>
<div><br/></div>
<div><span style="color: rgb(255, 38, 0);">Android库文件的后缀名：</span></div>
<div>.aar而非普通Java库的.jar格式</div>
<div>(android archive .aar) is not (java archive .jar)</div>
<div><br/></div>
<div><br/></div>
<div><span style="color: rgb(255, 38, 0);">. 将库上传到内部maven服务器</span></div>
<div><br/></div>
<div>. maven服务器简单来说就是一个存储服务器，存储所有的libraries。既然只是一个存储服务器，没有业务逻辑，所以哪怕是本地文件系统，也可以当做maven服务器</div>
<div><br/></div>
<div><span style="color: rgb(255, 64, 255);">这里介绍2种方式:</span></div>
<div><br/></div>
<div><span style="color: rgb(255, 64, 255);">1.</span> 将gitlab或者github这种SCM存放代码的地方用来做库的存储服务器（既然可以存放代码，当然也可以存放库这种格式的文件）</div>
<div><br/></div>
<div><span style="color: rgb(255, 64, 255);">分析：</span></div>
<div>github上的任何项目(repo)， 要上传文件，必须在本机clone下来的文件夹内添加文件，然后git add/git commit/git push上传</div>
<div><br/></div>
<div>可以参看我的github例子:</div>
<div><a href="https://github.com/ericxu1983/AndroidPlayGround/tree/master/github_as_mvn_repo_example/MyLib">https://github.com/ericxu1983/AndroidPlayGround/tree/master/github_as_mvn_repo_example</a></div>
<div><br/></div>
<div><span style="color: rgb(255, 64, 255);">因此方案如下：</span></div>
<div>1. 打包完成后， 将包“拷贝”到本地github文件夹</div>
<div>2. 在github文件夹内git add/git commit/git push，上传到github服务器</div>
<div>3. 使用方添加github上库对应版本的url做为maven的额外仓库地址</div>
<div><br/></div>
<div>. 打包上传如下， 在pom.project里制定pom.xml的一些信息（例如是哪个版本等）</div>
<div><img src="%E6%90%AD%E5%BB%BA%E5%86%85%E9%83%A8maven%E4%BB%93%E5%BA%93.resources/11B79FFE-DFB0-4530-8B44-9D63992CBEC3.png" height="520" width="1612"/></div>
<div><br/></div>
<div>
<hr/></div>
<div>然后在shell上调用:</div>
<div><span style="color: rgb(255, 64, 255);">gradle upload</span></div>
<div>进行上传</div>
<div><br/></div>
<div><span style="color: rgb(255, 64, 255);">使用方如下方式使用：</span></div>
<div><img src="%E6%90%AD%E5%BB%BA%E5%86%85%E9%83%A8maven%E4%BB%93%E5%BA%93.resources/6CFC8B85-981A-460D-9420-CAF8ADDCB4DC.png" height="462" width="1648"/></div>
<div><br/></div>
<div>
<hr/></div>
<div><br/></div>
<div><br/></div>
<div><span style="color: rgb(255, 64, 255);">方式2：搭建真正的maven中央仓库server</span></div>
<div>1. 使用sonatype的nexus来搭建maven中央仓库，搭建方法非常简单</div>
<div>2. <a href="http://www.sonatype.org/nexus/go/">http://www.sonatype.org/nexus/go/</a> 下载开源版本（OSS)的zip文件</div>
<div>3. 解压, 在命令行上运行其中的bin/nexus便可以了</div>
<div>4. 访问127.0.0.1:8081，点击Repositories，可以查看所有仓库，假设这里我们上传的包是一个每日构建的非稳定版本的包（SNAPSHOT)</div>
<div><br/></div>
<div>可以参看我的github例子：</div>
<div><a href="https://github.com/ericxu1983/AndroidPlayGround/tree/master/upload_to_center_mvn_repo/MyLib/.idea">https://github.com/ericxu1983/AndroidPlayGround/tree/master/upload_to_center_mvn_repo</a></div>
<div><br/></div>
<div><img src="%E6%90%AD%E5%BB%BA%E5%86%85%E9%83%A8maven%E4%BB%93%E5%BA%93.resources/E59764E1-1330-4E15-8A67-5043BBB849C0.png" height="1418" width="2560"/></div>
<div><br/></div>
<div>
<hr/></div>
<div><br/></div>
<div><span style="color: rgb(255, 64, 255);">打包上传：</span></div>
<div><img src="%E6%90%AD%E5%BB%BA%E5%86%85%E9%83%A8maven%E4%BB%93%E5%BA%93.resources/3E9C505B-0C42-4FE1-A56B-8B7599017DD5.png" height="1418" width="2520"/></div>
<div><br/></div>
<div>使用方：</div>
<div><img src="%E6%90%AD%E5%BB%BA%E5%86%85%E9%83%A8maven%E4%BB%93%E5%BA%93.resources/87438D49-8AEA-4E7F-8E16-CC10BC8AC32A.png" height="1418" width="2520"/></div>
<div><br/></div>
<div><span style="color: rgb(255, 64, 255);">其他注意事项：</span></div>
<div>1. 每次修改库，必须更改版本号，否则使用方使用从使用方本地的cache中使用，不会去服务器上更新</div>
<div>2. 如果是一个snapshot包，version name必须以-SNAPSHOT结尾</div>
</body></html>